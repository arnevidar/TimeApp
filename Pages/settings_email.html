<!DOCTYPE HTML>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Settings</title>

    <script type="text/javascript" charset="utf-8" src="../js/phonegap-1.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/mobiscroll-1.5.3.css"/>
    <link rel="stylesheet" type="text/css" href="../css/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/jquery.mobile.datebox.css"/>
    <link rel="stylesheet" type="text/css" href="../css/jquery.mobile.simpledialog.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="http://dev.jtsage.com/cdn/datebox/latest/jquery.mobile.datebox.min.css" />

    <script type="text/javascript" charset="utf-8" src="../js/jquery-1.7.1.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/jquery.mobile-1.0.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/jquery.mobile.simpledialog.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/jquery.toaster.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/jquery.mobile.datebox.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/persistence.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/mobiscroll-1.5.3.js"></script>

    <script type="text/javascript">
        // Wait for PhoneGap to load

        var esFilename = "emailsettings";

        document.addEventListener("deviceready", onDeviceReady, false);

        // PhoneGap is ready
        //
        function onDeviceReady() {
            readEmailSettingsFile("emailsettings");
            $("#toggle-email").change(enableOrDisableInputs);
        }

        function enableOrDisableInputs (event, ui) {
            if ($("#toggle-email").val() == "off") {
                $("#select-weekday").addClass('ui-disabled');
                //$("#select-weekday").selectmenu('disabled', true);
                $("#select-weekday").selectmenu('refresh', true);
                $("#email-time").addClass('ui-disabled');
                $("#email").addClass('ui-disabled');
            }
            else {
                $("#select-weekday").removeClass('ui-disabled');
                if ($("#select-weekday").attr("disabled") == false) { $("#select-weekday").removeAttr("disabled").menusle; }
                //$("#select-weekday").selectmenu('disabled', false);
                $("#select-weekday").selectmenu('refresh', true);
                $("#email-time").removeClass('ui-disabled');
                $("#email").removeClass('ui-disabled');
            }
        }

        function failSaveSettings(error) {
            console.log(error.code);
            alert("Error unable to access files, application will close. File error: " + error.code);
        }

        function successfullyReadEmailSettings(result) {
            var res = JSON.parse(result);
            $("#email").val(res.email);
            $("#toggle-email").val(res.toggleEmail).slider('refresh');
            $("#select-weekday").val(res.weekday.toLowerCase()).selectmenu('refresh');
            $("#email-time").val(res.time);
        }

        function settingsSavedDialog() { //on jquery load
            window.location.href = "settings.html";

        }

        function readEmailSettingsFile() {
            var p = new Persistence();
            p.readfile("emailsettings", successfullyReadEmailSettings, failSaveSettings );
        }

        function saveEmailSettings() {
            var toaster = $.toaster({showTime:1000, centerX:true, centerY:true}); // create a toaster
            toaster.toast("Information updated");//show a toast message
            var emailSettings = new Object();
            emailSettings.email = $("#email").val();
            emailSettings.toggleEmail = $("#toggle-email").val();
            emailSettings.weekday = $("#select-weekday").val();
            emailSettings.time = $("#email-time").val();
            var jsonString = JSON.stringify(emailSettings);
            var p = new Persistence();
            p.writefile(esFilename, emailSettings, settingsSavedDialog ,failSaveSettings);
        }

        $(document).ready(function() {
            var Adate = new Date(0,0,0,0,0,0,0);
            $("#email-time").scroller({ preset: 'time', hourText: 'Hours',minuteText:'Minutes',
                stepMinute: 1, ampm: false, timeFormat : 'HH:ii'});
            $("#email-time").scroller('setDate', Adate, true);
        });

        function choseHoursAndMinutes() {
            $("#show_time_picker_link").scroller('show');
        }






    </script>
</head>
<body>

<!-- Email settings page -->

<div data-role="page" id="emailSettings">

    <!-- header -->

    <div data-role="header">
        <h2>Email settings</h2>
    </div>

    <!-- content -->

    <div data-role="content">


        <!-- toggle notification flip switch -->

        <div data-role="fieldcontain">
            <label for="toggle-email">Toggle email notification:</label>
            <select name="slider" id="toggle-email" data-role="slider">
                <option value="off">Off</option>
                <option value="on">On</option>
            </select>
        </div>


        <!-- Email input field -->

        <div data-role="fieldcontain">
            <label for="email">Email:</label>
            <input type="text" name="name" id="email" placeholder="Email" />
        </div>


        <!-- Daypicker -->

        <div data-role="fieldcontain">
            <label for="select-weekday">Select day to send Email:</label>
            <select name="select-weekday" id="select-weekday">
                <option value="monday">Monday</option>
                <option value="tuesday">Tuesday</option>
                <option value="wednesday">Wednesday</option>
                <option value="thursday">Thursday</option>
                <option value="friday">Friday</option>
                <option value="saturday">Saturday</option>
                <option value="sunday">Sunday</option>
            </select>
        </div>

        <!-- Timepicker -->
        <div data-role="fieldcontain">
            <label for="email-time">Set the time for the email to be sent:</label>
            <input type="time" id="email-time"/>
        </div>



        <!-- Buttons -->

        <div data-role="fieldcontain">
            <a href="#settings" data-role="button" data-inline="true" data-icon="delete" data-iconpos="notext"></a>
            <a data-role="button" data-inline="true" data-icon="check" data-iconpos="notext" onclick="saveEmailSettings()"></a>
        </div>

        <!-- Footer -->

        <script type="text/javascript" src="../js/navbar.js"></script>

    </div>
</div>

</body>
</html>