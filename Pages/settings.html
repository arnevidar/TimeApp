<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

        <title>Settings</title>

        <script type="text/javascript" charset="utf-8" src="../js/phonegap-1.3.0.js"></script>

        <link rel="stylesheet" type="text/css" href="../css/jquery.mobile-1.0.min.css" />
        <link rel="stylesheet" type="text/css" href="../css/jquery.mobile.datebox.css"/>
        <link rel="stylesheet" type="text/css" href="../css/jquery.mobile.simpledialog.min.css"/>
        <link rel="stylesheet" type="text/css" href="../css/style.css"/>

        <script type="text/javascript" charset="utf-8" src="../js/jquery-1.7.1.js"></script>
        <script type="text/javascript" charset="utf-8" src="../js/jquery.mobile-1.0.js"></script>
        <script type="text/javascript" charset="utf-8" src="../js/jquery.mobile.simpledialog.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="../js/jquery.toaster.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="../js/jquery.mobile.datebox.js"></script>
        <script type="text/javascript" charset="utf-8" src="../js/persistence.js"></script>

        <script type="text/javascript">

            var esFilename = "emailsettings";
            var nsFilename = "notificationsettings";

            function loadEmailSettings() {
                alert("Page is loaded");
            }

            function failSaveSettings(error) {
                console.log(error.code);
            }

            function successfullyReadEmailSettings(result) {
                var res = JSON.parse(result);
                $("#email").attr() = res.email;
                $("#toggle-email").attr() = res.enabled;
                $("#select-weekday").attr() = res.weekday;
                $("#email-time").attr() = res.time;
            }

            function successfullyReadNotificationSettings(result) {
                var res = JSON.parse(result);
                $("#toggle-notifications").attr() = res.enabled;
                $("#select-interval").attr() = res.interval;
                $("#notification-time").attr() = res.time;
            }

            function saveEmailSettings() {
                var emailSettings = new Object();
                emailSettings.email = $("#email").val();
                emailSettings.enabled = $("#toggle-email").val();
                emailSettings.weekday = $("#select-weekday").val();
                emailSettings.time = $("#email-time").val();
                var jsonString = JSON.stringify(emailSettings);
                writefile(esFilename, emailSettings, failPushEmailSettings);
                settingsSavedDialog();
            }


            function settingsSavedDialog() { //on jquery load
                var toaster = $.toaster({showTime:1000, centerX:true, centerY:true}); // create a toaster
                toaster.toast("Saved");//show a toast message
            }

            function readEmailSettingsFile(filename) {
                readfile(filename, successfullyReadEmailSettings, failSaveSettings );
            }

            function readNotificationSettingsFile(filename) {
                readfile(filename, successfullyReadNotificationSettings, failSaveSettings );
            }

            function saveNotificationSettings() {
                var notificationSettings = new Object();
                notificationSettings.enabled = $("#toggle-notification").val();
                notificationSettings.interval = $("#select-interval").val();
                notificationSettings.time = $("#notification-time").val();
                var jsonString = JSON.stringify(notificationSettings);
                writefile(nsFilename, notificationSettings, failSaveSettings);
                settingsSavedDialog();
            }


        </script>
    </head>
    <body onload="readEmailSettingsFile(esFilename); readNotificationSettingsFile(nsFilename)">

        <!-- Settings page-->

        <div data-role="page" id="settings">
            <div data-role="header">
                <h2>Settings</h2>
            </div> <!-- header -->

            <div data-role="content">
                <div data-role="controlgroup">
                    <a href="#notificationSettings" data-role="button"
                       data-icon="arrow-r" data-iconpos="right" data-transition="slide" >Notifications</a>
                    <a href="#emailSettings" data-role="button"
                       data-icon="arrow-r" data-iconpos="right">Email settings</a>
                </div> <!-- controlgroup -->

            </div> <!-- content -->
            <script type="text/javascript" src="../js/navbar.js"></script>
        </div> <!-- Settings page -->

        <!-- Email settings page -->

        <div data-role="page" id="emailSettings">
            <div data-role="header">
                <h2>Email settings</h2>
            </div><!-- header -->

            <div data-role="content">

                <div data-role="fieldcontain">
                    <label for="email">Email:</label>
                    <input type="text" name="name" id="email" placeholder="Email" />
                </div> <!-- Email input field -->

                <div data-role="fieldcontain">
                    <label for="toggle-email">Toggle email notification:</label>
                    <select name="slider" id="toggle-email" data-role="slider">
                        <option value="off">Off</option>
                        <option value="on">On</option>
                    </select>
                </div> <!-- toggle notification flip switch -->

                <div data-role="fieldcontain">
                    <label for="select-weekday">Select day to send Email:</label>
                    <select name="select-weekday" id="select-weekday">
                        <option value="monday">Monday</option>
                        <option value="tuesday">Tuesday</option>
                        <option value="wednesday">Wednesday</option>
                        <option value="thursday">Thursday</option>
                        <option value="friday">Friday</option>
                        <option value="saturday">Saturday</option>
                        <option value="sunday">Sunday</option>
                    </select>
                </div> <!-- daypicker -->

                <div data-role="fieldcontain">
                    <label for="email-time">Set the time for the email to be sent:</label>
                    <input name="mydate" id="email-time" type="date" data-role="datebox" data-rel="dialog" value="04:00"
                           data-options='{"mode": "timeflipbox"}'>
                </div> <!-- Timepicker -->

                <div data-role="fieldcontain">
                    <a href="#settings" data-role="button" data-inline="true" data-icon="delete" data-iconpos="notext"></a>
                    <a data-role="button" data-inline="true" data-icon="check" data-iconpos="notext" onclick="saveEmailSettings()"></a>
                </div>

                <script type="text/javascript" src="../js/navbar.js"></script>

            </div> <!-- content -->
        </div><!-- page -->

        <!-- Notification settings -->

        <div data-role="page" id="notificationSettings">
            <div data-role="header">
                <h2>Notification settings</h2>
            </div><!-- header -->

            <div data-role="content">

                <div data-role="fieldcontain">
                    <label for="toggle-notifications">Toggle email notification:</label>
                    <select name="slider" id="toggle-notifications" data-role="slider">
                        <option value="off">Off</option>
                        <option value="on">On</option>
                    </select>
                </div> <!-- fieldcontain - flip switch -->

                <div data-role="fieldcontain">
                    <label for="select-interval">Repeat:</label>
                    <a href="#notification-day" id="select-interval" data-role="button" data-inline="true" data-rel="dialog">Choose day(s)</a>
                </div>

                <div data-role="fieldcontain">
                    <label for="notification-time">Time:</label>
                    <input name="mydate" id="notification-time" type="date" data-role="datebox" data-inline="true" value="04:00"
                           data-options='{"mode": "timeflipbox"}' >
                </div> <!-- Timepicker -->


                <div data-role="fieldcontain">
                    <a href="settings.html" id="dialog" data-role="button" data-inline="true" data-icon="delete" data-iconpos="notext" rel="back"></a>
                    <a data-role="button" data-inline="true" data-icon="check" data-iconpos="notext" onclick="saveNotificationSettings()"></a>
                </div>
            </div>

            <script type="text/javascript" src="../js/navbar.js"></script>
        </div> <!-- Settings page -->


        <!-- Notification day dialog -->

        <div data-role="page" id="notification-day">
            <div data-role="fieldcontain">
                <fieldset data-role="controlgroup">
                    <legend>Choose day(s)</legend>
                    <input type="checkbox" name="monday" id="monday" class="custom" />
                    <label for="monday">Monday</label>
                    <input type="checkbox" name="tuesday" id="tuesday" class="custom" />
                    <label for="tuesday">Tuesday</label>
                    <input type="checkbox" name="wednesday" id="wednesday" class="custom" />
                    <label for="wednesday">Wednesday</label>
                    <input type="checkbox" name="thursday" id="thursday" class="custom" />
                    <label for="thursday">Thursday</label>
                    <input type="checkbox" name="friday" id="friday" class="custom" />
                    <label for="friday">Friday</label>
                    <input type="checkbox" name="saturday" id="saturday" class="custom" />
                    <label for="saturday">Saturday</label>
                    <input type="checkbox" name="sunday" id="sunday" class="custom" />
                    <label for="sunday">Sunday</label>
                </fieldset>

                <a href="#notificationSettings" data-role="button" data-inline="true" data-icon="delete" data-iconpos="notext"></a>
                <a href="" data-role="button" data-inline="true" data-icon="check" data-iconpos="notext"></a>
            </div>
        </div>

    </body>
</html>